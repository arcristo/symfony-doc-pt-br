

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="pt-BR" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="pt-BR" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Enviando E-mails com o Mailer &mdash; Documentação do Symfony  documentação</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="next" title="Os Componentes" href="components/index.html" />
    <link rel="prev" title="Servidor Web Local do Symfony" href="setup/symfony_server.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Documentação do Symfony
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quick_tour/index.html">O Tour Rápido</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started/index.html">Começando</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Enviando E-mails com o Mailer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#instalacao">Instalação</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuracao-do-transporte">Configuração do Transporte</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usando-um-transporte-de-terceiros">Usando um Transporte de Terceiros</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#criando-e-enviando-mensagens">Criando e Enviando Mensagens</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enderecos-de-e-mail">Endereços de E-mail</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conteudo-da-mensagem">Conteúdo da Mensagem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arquivos-anexo">Arquivos Anexo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#incorporando-imagens">Incorporando Imagens</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#endereco-from-global">Endereço from Global</a></li>
<li class="toctree-l2"><a class="reference internal" href="#twig-html-e-css">Twig: HTML e CSS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conteudo-html">Conteúdo HTML</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conteudo-de-texto">Conteúdo de Texto</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Incorporando Imagens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#estilos-css-inline">Estilos CSS Inline</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#usando-arquivos-css-externos">Usando Arquivos CSS Externos</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#renderizando-conteudo-markdown">Renderizando Conteúdo Markdown</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linguagem-de-template-de-e-mail-inky">Linguagem de Template de E-mail Inky</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#enviando-mensagens-assincronas">Enviando Mensagens Assíncronas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#desenvolvimento-e-depuracao">Desenvolvimento e Depuração</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#desabilitando-a-entrega">Desabilitando a Entrega</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enviar-sempre-para-o-mesmo-endereco">Enviar Sempre para o Mesmo Endereço</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Instalando e Configurando o Symfony Framework</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="components/index.html">Os Componentes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">Documentos de Referência</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing/index.html">Contribuindo</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="create_framework/index.html">Crie seu próprio Framework PHP</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Documentação do Symfony</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Enviando E-mails com o Mailer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/adielcristo/symfony-doc-pt-br/blob/5.0/mailer.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enviando-e-mails-com-o-mailer">
<h1>Enviando E-mails com o Mailer<a class="headerlink" href="#enviando-e-mails-com-o-mailer" title="Link permanente para este título">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">Novo na versão 4.3: </span>O componente Mailer foi adicionado no Symfony 4.3 e atualmente é experimental.
A solução anterior - Swift Mailer - ainda é válida: <code class="xref doc docutils literal notranslate">Swift Mailer</code>.</p>
</div>
<div class="section" id="instalacao">
<h2>Instalação<a class="headerlink" href="#instalacao" title="Link permanente para este título">¶</a></h2>
<div class="admonition-wrapper">
<div class="admonition caution"><p class="first admonition-title">Cuidado</p>
<p class="last">O componente Mailer é experimental no Symfony 4.3: alguma quebra de compatibilidade com
versões anteriores pode ocorrer antes da versão 4.4.</p>
</div></div>
<p>Os componentes Mailer e <code class="xref doc docutils literal notranslate">Mime</code> do Symfony formam um sistema <em>poderoso</em>
para criar e enviar e-mails - completo com suporte para mensagens multipartes, integração
com o Twig, CSS inline, anexos de arquivos e muito mais. Instale-os com:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/mailer
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="configuracao-do-transporte">
<h2>Configuração do Transporte<a class="headerlink" href="#configuracao-do-transporte" title="Link permanente para este título">¶</a></h2>
<p>Os e-mails são entregues através de um &quot;transporte&quot;. E sem instalar mais nada, você
pode enviar emails usando <code class="docutils literal notranslate">smtp</code> apenas configurando o seguinte em seu arquivo <code class="docutils literal notranslate">.env</code>:</p>
<div class="literal-block"><div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># .env</span>
<span class="nv">MAILER_DSN</span><span class="o">=</span>smtp://user:pass@smtp.example.com
</pre></div>
</td></tr></table></div></div>
<div class="section" id="usando-um-transporte-de-terceiros">
<h3>Usando um Transporte de Terceiros<a class="headerlink" href="#usando-um-transporte-de-terceiros" title="Link permanente para este título">¶</a></h3>
<p>Mas uma opção mais fácil é enviar e-mails através de um provedor de terceiros. O Mailer suporta
vários - instale o que você desejar:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Serviço</th>
<th class="head">Instale com</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Amazon SES</td>
<td><code class="docutils literal notranslate">composer require symfony/amazon-mailer</code></td>
</tr>
<tr class="row-odd"><td>Gmail</td>
<td><code class="docutils literal notranslate">composer require symfony/google-mailer</code></td>
</tr>
<tr class="row-even"><td>MailChimp</td>
<td><code class="docutils literal notranslate">composer require symfony/mailchimp-mailer</code></td>
</tr>
<tr class="row-odd"><td>Mailgun</td>
<td><code class="docutils literal notranslate">composer require symfony/mailgun-mailer</code></td>
</tr>
<tr class="row-even"><td>Postmark</td>
<td><code class="docutils literal notranslate">composer require symfony/postmark-mailer</code></td>
</tr>
<tr class="row-odd"><td>SendGrid</td>
<td><code class="docutils literal notranslate">composer require symfony/sendgrid-mailer</code></td>
</tr>
</tbody>
</table>
<p>Cada biblioteca inclui uma <span class="xref std std-ref">receita Flex</span> que adicionará configuração exemplo
em seu arquivo <code class="docutils literal notranslate">.env</code>. Por exemplo, supondo que você queira usar o SendGrid. Primeiro,
instale-o:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/sendgrid-mailer
</pre></div>
</td></tr></table></div></div>
<p>Você agora terá uma nova linha no seu arquivo <code class="docutils literal notranslate">.env</code> que você pode remover o seu comentário:</p>
<div class="literal-block"><div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># .env</span>
<span class="nv">SENDGRID_KEY</span><span class="o">=</span>
<span class="nv">MAILER_DSN</span><span class="o">=</span>smtp://<span class="nv">$SENDGRID_KEY</span>@sendgrid
</pre></div>
</td></tr></table></div></div>
<p>O <code class="docutils literal notranslate">MAILER_DSN</code> não é um endereço SMTP <em>real</em>: é um formato simples que transfere
a maior parte do trabalho de configuração para o mailer. A parte <code class="docutils literal notranslate">&#64;sendgrid</code> do endereço
ativa a biblioteca de e-mail SendGrid que você acabou de instalar, que sabe tudo
sobre como entregar mensagens para o SendGrid.</p>
<p>A <em>única</em> parte que você precisa alterar é setar a sua chave em <code class="docutils literal notranslate">SENDGRID_KEY</code> (no
arquivo <code class="docutils literal notranslate">.env</code> ou `` .env.local``).</p>
<p>Cada transporte terá variáveis de ambiente diferentes que a biblioteca usará
para configurar o endereço <em>real</em> e a autenticação para entrega. Alguns também têm
opções que podem ser configuradas com parâmetros query no final do <code class="docutils literal notranslate">MAILER_DSN</code> -
como <code class="docutils literal notranslate">?region = `` para o Amazon SES. Alguns transportes suportam o envio via ``http</code>
ou <code class="docutils literal notranslate">smtp</code> - ambos funcionam da mesma forma, mas <code class="docutils literal notranslate">http</code> é recomendado quando disponível.</p>
</div>
</div>
<div class="section" id="criando-e-enviando-mensagens">
<h2>Criando e Enviando Mensagens<a class="headerlink" href="#criando-e-enviando-mensagens" title="Link permanente para este título">¶</a></h2>
<p>Para enviar um email, faça o autowire do mailer usando
<code class="docutils literal notranslate"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Mailer/MailerInterface.html" title="Symfony\Component\Mailer\MailerInterface">MailerInterface</a></code> (id de serviço <code class="docutils literal notranslate">mailer</code>)
e crie um objeto <code class="docutils literal notranslate"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Mime/Email.html" title="Symfony\Component\Mime\Email">Email</a></code>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/MailerController.php</span>
<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\MailerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MailerController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/email&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="nx">MailerInterface</span> <span class="nv">$mailer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;hello@example.com&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;you@example.com&#39;</span><span class="p">)</span>
            <span class="c1">//-&gt;cc(&#39;cc@example.com&#39;)</span>
            <span class="c1">//-&gt;bcc(&#39;bcc@example.com&#39;)</span>
            <span class="c1">//-&gt;replyTo(&#39;fabien@example.com&#39;)</span>
            <span class="c1">//-&gt;priority(Email::PRIORITY_HIGH)</span>
            <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;Time for Symfony Mailer!&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;Sending emails is fun again!&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;See Twig integration for better HTML integration!&lt;/p&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>É isso! A mensagem será enviada através do transporte que você configurou.</p>
<div class="section" id="enderecos-de-e-mail">
<h3>Endereços de E-mail<a class="headerlink" href="#enderecos-de-e-mail" title="Link permanente para este título">¶</a></h3>
<p>Todos os métodos que requerem endereços de e-mail (<code class="docutils literal notranslate">from()</code>, <code class="docutils literal notranslate">to()</code>, etc.) aceitam
tanto strings quanto objetos de endereço:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Address</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\NamedAddress</span><span class="p">;</span>

<span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="c1">// email address as a simple string</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;fabien@example.com&#39;</span><span class="p">)</span>

    <span class="c1">// email address as an object</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="k">new</span> <span class="nx">Address</span><span class="p">(</span><span class="s1">&#39;fabien@example.com&#39;</span><span class="p">))</span>

    <span class="c1">// email address as an object (email clients will display the name</span>
    <span class="c1">// instead of the email address)</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="k">new</span> <span class="nx">NamedAddress</span><span class="p">(</span><span class="s1">&#39;fabien@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">))</span>

    <span class="c1">// ...</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>Múltiplos endereços são definidos com os métodos <code class="docutils literal notranslate">addXXX()</code>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span><span class="s1">&#39;bar@example.com&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span><span class="s1">&#39;baz@example.com&#39;</span><span class="p">)</span>

    <span class="c1">// ...</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>Alternativamente, você pode passar vários endereços para cada método:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$toAddresses</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Address</span><span class="p">(</span><span class="s1">&#39;bar@example.com&#39;</span><span class="p">)];</span>

<span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="o">...</span><span class="nv">$toAddresses</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">cc</span><span class="p">(</span><span class="s1">&#39;cc1@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;cc2@example.com&#39;</span><span class="p">)</span>

    <span class="c1">// ...</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="conteudo-da-mensagem">
<h3>Conteúdo da Mensagem<a class="headerlink" href="#conteudo-da-mensagem" title="Link permanente para este título">¶</a></h3>
<p>O texto e o conteúdo HTML das mensagens de e-mail podem ser strings (geralmente
resultado da renderização de algum template) ou recursos PHP:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="c1">// ...</span>
    <span class="c1">// simple contents defined as a string</span>
    <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;Lorem ipsum...&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;Lorem ipsum...&lt;/p&gt;&#39;</span><span class="p">)</span>

    <span class="c1">// attach a file stream</span>
    <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/emails/user_signup.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/emails/user_signup.html&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="admonition tip"><p class="first admonition-title">Dica</p>
<p class="last">Você também pode usar templates Twig para renderizar o conteúdo HTML e de texto. Leia
a seção <a class="reference internal" href="#twig-html-e-css">Twig: HTML e CSS</a> mais adiante neste artigo para
saber mais.</p>
</div></div>
</div>
<div class="section" id="arquivos-anexo">
<h3>Arquivos Anexo<a class="headerlink" href="#arquivos-anexo" title="Link permanente para este título">¶</a></h3>
<p>Use o método <code class="docutils literal notranslate">attachFromPath()</code> para anexar arquivos que existem no seu sistema de arquivos:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="c1">// ...</span>
    <span class="o">-&gt;</span><span class="na">attachFromPath</span><span class="p">(</span><span class="s1">&#39;/path/to/documents/terms-of-use.pdf&#39;</span><span class="p">)</span>
    <span class="c1">// optionally you can tell email clients to display a custom name for the file</span>
    <span class="o">-&gt;</span><span class="na">attachFromPath</span><span class="p">(</span><span class="s1">&#39;/path/to/documents/privacy.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;Privacy Policy&#39;</span><span class="p">)</span>
    <span class="c1">// optionally you can provide an explicit MIME type (otherwise it&#39;s guessed)</span>
    <span class="o">-&gt;</span><span class="na">attachFromPath</span><span class="p">(</span><span class="s1">&#39;/path/to/documents/contract.doc&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract&#39;</span><span class="p">,</span> <span class="s1">&#39;application/msword&#39;</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>Como alternativa, você pode usar o método <code class="docutils literal notranslate">attach()</code> para anexar conteúdo a partir de um stream:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="c1">// ...</span>
    <span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/documents/contract.doc&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="incorporando-imagens">
<h3>Incorporando Imagens<a class="headerlink" href="#incorporando-imagens" title="Link permanente para este título">¶</a></h3>
<p>Se você quiser exibir imagens dentro do seu e-mail, você deve incorporá-las
em vez de adicioná-las como anexos. Ao usar o Twig para renderizar o conteúdo
do e-mail, como explicado <a class="reference external" href="EmbeddingImages">mais adiante neste artigo</a>,
as imagens são incorporadas automaticamente. Caso contrário, você precisa incorporá-las manualmente.</p>
<p>Primeiro, use o método <code class="docutils literal notranslate">embed()</code> ou <code class="docutils literal notranslate">embedFromPath()</code> para adicionar uma imagem a partir de um
arquivo ou stream:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="c1">// ...</span>
    <span class="c1">// get the image contents from a PHP resource</span>
    <span class="o">-&gt;</span><span class="na">embed</span><span class="p">(</span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/images/logo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="s1">&#39;logo&#39;</span><span class="p">)</span>
    <span class="c1">// get the image contents from an existing file</span>
    <span class="o">-&gt;</span><span class="na">embedFromPath</span><span class="p">(</span><span class="s1">&#39;/path/to/images/signature.gif&#39;</span><span class="p">,</span> <span class="s1">&#39;footer-signature&#39;</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>O segundo argumento opcional de ambos os métodos é o nome da imagem (&quot;Content-ID&quot; no
padrão MIME). Seu valor é uma string arbitrária usada posteriormente para referenciar
imagens dentro do conteúdo HTML:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
    <span class="c1">// ...</span>
    <span class="o">-&gt;</span><span class="na">embed</span><span class="p">(</span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/images/logo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="s1">&#39;logo&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">embedFromPath</span><span class="p">(</span><span class="s1">&#39;/path/to/images/signature.gif&#39;</span><span class="p">,</span> <span class="s1">&#39;footer-signature&#39;</span><span class="p">)</span>
    <span class="c1">// reference images using the syntax &#39;cid:&#39; + &quot;image embed name&quot;</span>
    <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;img src=&quot;cid:logo&quot;&gt; ... &lt;img src=&quot;cid:footer-signature&quot;&gt; ...&#39;</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="endereco-from-global">
<h2>Endereço from Global<a class="headerlink" href="#endereco-from-global" title="Link permanente para este título">¶</a></h2>
<p>Em vez de chamar <code class="docutils literal notranslate">-&gt;from()</code> <em>cada</em> vez que você cria um novo e-mail, você pode
criar um subscriber de evento para configurá-lo automaticamente:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/EventListener/MailerFromListener.php</span>
<span class="k">namespace</span> <span class="nx">App\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\EventDispatcher\EventSubscriberInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Event\MessageEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MailerFromListener</span> <span class="k">implements</span> <span class="nx">EventSubscriberInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onMessageSend</span><span class="p">(</span><span class="nx">MessageEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

        <span class="c1">// make sure it&#39;s an Email object</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$message</span> <span class="nx">instanceof</span> <span class="nx">Email</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// always set the from address</span>
        <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;fabien@example.com&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nx">MessageEvent</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="s1">&#39;onMessageSend&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="twig-html-e-css">
<span id="mailer-twig"></span><h2>Twig: HTML e CSS<a class="headerlink" href="#twig-html-e-css" title="Link permanente para este título">¶</a></h2>
<p>O componente Mime se integra com a <code class="xref doc docutils literal notranslate">engine de template Twig</code>
para fornecer recursos avançados, como CSS inline e suporte para frameworks HTML/CSS
para criar mensagens de e-mail complexas em HTML. Primeiro, verifique se o Twig está instalado:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/twig-bundle
</pre></div>
</td></tr></table></div></div>
<div class="section" id="conteudo-html">
<h3>Conteúdo HTML<a class="headerlink" href="#conteudo-html" title="Link permanente para este título">¶</a></h3>
<p>Para definir o conteúdo do seu e-mail com o Twig, use a
classe <code class="docutils literal notranslate"><a class="reference external" href="http://api.symfony.com/master/Symfony/Bridge/Twig/Mime/TemplatedEmail.html" title="Symfony\Bridge\Twig\Mime\TemplatedEmail">TemplatedEmail</a></code>. Essa classe estende
a classe normal <code class="docutils literal notranslate"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Mime/Email.html" title="Symfony\Component\Mime\Email">Email</a></code> mas adiciona alguns métodos novos
para templates Twig:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Bridge\Twig\Mime\TemplatedEmail</span><span class="p">;</span>

<span class="nv">$email</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">TemplatedEmail</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;fabien@example.com&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="k">new</span> <span class="nx">NamedAddress</span><span class="p">(</span><span class="s1">&#39;ryan@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Ryan&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;Thanks for signing up!&#39;</span><span class="p">)</span>

    <span class="c1">// path of the Twig template to render</span>
    <span class="o">-&gt;</span><span class="na">htmlTemplate</span><span class="p">(</span><span class="s1">&#39;emails/signup.html.twig&#39;</span><span class="p">)</span>

    <span class="c1">// pass variables (name =&gt; value) to the template</span>
    <span class="o">-&gt;</span><span class="na">context</span><span class="p">([</span>
        <span class="s1">&#39;expiration_date&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="s1">&#39;+7 days&#39;</span><span class="p">),</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
    <span class="p">])</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>Em seguida, crie o template:</p>
<div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# templates/emails/signup.html.twig #}</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome <span class="cp">{{</span> <span class="nv">email.toName</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    You signed up as <span class="cp">{{</span> <span class="nv">username</span> <span class="cp">}}</span> the following email:
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">email.to</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="nv">.address</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">&gt;</span>Click here to activate your account<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    (this link is valid until <span class="cp">{{</span> <span class="nv">expiration_date</span><span class="o">|</span><span class="nf">date</span><span class="o">(</span><span class="s1">&#39;F jS&#39;</span><span class="o">)</span> <span class="cp">}}</span>)
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>O template Twig tem acesso a qualquer um dos parâmetros passados no método
<code class="docutils literal notranslate">context()</code> da classe <code class="docutils literal notranslate">TemplatedEmail</code> e também para uma variável especial
chamada `` email``, que é uma instância de
<code class="docutils literal notranslate"><a class="reference external" href="http://api.symfony.com/master/Symfony/Bridge/Twig/Mime/WrappedTemplatedEmail.html" title="Symfony\Bridge\Twig\Mime\WrappedTemplatedEmail">WrappedTemplatedEmail</a></code>.</p>
</div>
<div class="section" id="conteudo-de-texto">
<h3>Conteúdo de Texto<a class="headerlink" href="#conteudo-de-texto" title="Link permanente para este título">¶</a></h3>
<p>Quando o conteúdo de texto de um <code class="docutils literal notranslate">TemplatedEmail</code> não é explicitamente definido, o mailer
irá gerá-lo automaticamente, convertendo o conteúdo HTML em texto. Se você
possui o <a class="reference external" href="https://github.com/thephpleague/html-to-markdown">league/html-to-markdown</a> instalado em sua aplicação,
ele irá usá-lo para transformar HTML em Markdown (para que o e-mail de texto tenha algum apelo visual).
Caso contrário, aplica-se a função PHP <code class="docutils literal notranslate"><a class="reference external" href="http://php.net/manual/en/function.strip-tags.php" title="strip_tags">strip_tags</a></code> ao
conteúdo HTML original.</p>
<p>Se você quiser definir o conteúdo do texto, use o método <code class="docutils literal notranslate">text()</code>
explicado nas seções anteriores ou o método <code class="docutils literal notranslate">textTemplate()</code> fornecido pela
classe <code class="docutils literal notranslate">TemplatedEmail</code>:</p>
<div class="literal-block"><div class="highlight-diff"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gi">+ use Symfony\Bridge\Twig\Mime\TemplatedEmail;</span>

$email = (new TemplatedEmail())
    // ...

    -&gt;htmlTemplate(&#39;emails/signup.html.twig&#39;)
<span class="gi">+     -&gt;textTemplate(&#39;emails/signup.txt.twig&#39;)</span>
    // ...
;
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id1">
<h3>Incorporando Imagens<a class="headerlink" href="#id1" title="Link permanente para este título">¶</a></h3>
<p>Em vez de lidar com a sintaxe <code class="docutils literal notranslate">&lt;img src=&quot;cid: ...&quot;&gt;</code> explicada nas
seções anteriores, ao usar o Twig para gerar conteúdo de e-mail você pode referenciar
os arquivos de imagem como de costume. Primeiro, para simplificar as coisas, defina um namespace Twig chamado
<code class="docutils literal notranslate">images</code> que aponta para o diretório onde suas imagens estão armazenadas:</p>
<div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/twig.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">twig</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
        <span class="c1"># point this wherever your images live</span>
        <span class="s">&#39;%kernel.project_dir%/assets/images&#39;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">images</span>
</pre></div>
</td></tr></table></div></div>
<p>Agora, use o helper especial <code class="docutils literal notranslate">email.image()</code> do Twig para incorporar as imagens dentro
do conteúdo do email:</p>
<div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# &#39;@images/&#39; refers to the Twig namespace defined earlier #}</span>
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">email.image</span><span class="o">(</span><span class="s1">&#39;@images/logo.png&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Logo&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome <span class="cp">{{</span> <span class="nv">email.toName</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="c">{# ... #}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="estilos-css-inline">
<span id="mailer-inline-css"></span><h3>Estilos CSS Inline<a class="headerlink" href="#estilos-css-inline" title="Link permanente para este título">¶</a></h3>
<p>Projetar o conteúdo HTML de um email é muito diferente de projetar uma
página HTML normal. Para começar, a maioria dos clientes de email suporta apenas um subconjunto
dos recursos CSS. Além disso, os clientes de e-mail populares, como o Gmail, não suportam
definir estilos dentro de seções <code class="docutils literal notranslate">&lt;style&gt; ... &lt;/ style&gt;</code> e você deve usar <strong>todos os
estilos CSS inline</strong>.</p>
<p>CSS inline significa que cada tag HTML deve definir um atributo <code class="docutils literal notranslate">style</code> com
todos os seus estilos CSS. Isso pode tornar a organização de seu CSS uma bagunça. É por isso que
o Twig fornece uma <code class="docutils literal notranslate">CssInlinerExtension</code> que automatiza tudo para você. Instale
com:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require twig/cssinliner-extension
</pre></div>
</td></tr></table></div></div>
<p>A extensão é ativada automaticamente. Para usá-la, envolva o template inteiro
com o filtro <code class="docutils literal notranslate">inline_css</code>:</p>
<div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">apply</span> <span class="nv">inline_css</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="c">{# here, define your CSS styles as usual #}</span>
        <span class="nt">h1</span> <span class="p">{</span>
            <span class="k">color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome <span class="cp">{{</span> <span class="nv">email.toName</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="c">{# ... #}</span>
<span class="cp">{%</span> <span class="k">endapply</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="usando-arquivos-css-externos">
<h4>Usando Arquivos CSS Externos<a class="headerlink" href="#usando-arquivos-css-externos" title="Link permanente para este título">¶</a></h4>
<p>Você também pode definir estilos CSS em arquivos externos e passá-los como
argumentos para o filtro:</p>
<div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">apply</span> <span class="nv">inline_css</span><span class="o">(</span><span class="nv">source</span><span class="o">(</span><span class="s1">&#39;@css/email.css&#39;</span><span class="o">))</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome <span class="cp">{{</span> <span class="nv">username</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="c">{# ... #}</span>
<span class="cp">{%</span> <span class="k">endapply</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
<p>Você pode passar um número ilimitado de argumentos em <code class="docutils literal notranslate">inline_css()</code> para carregar múltiplos
arquivos CSS. Para esse exemplo funcionar, você também precisa definir um novo namespace Twig
chamado <code class="docutils literal notranslate">css</code> que aponta para o diretório onde <code class="docutils literal notranslate">email.css</code> encontra-se:</p>
<div class="literal-block"><div class="highlight-yaml" id="mailer-css-namespace"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/twig.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">twig</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
        <span class="c1"># point this wherever your css files live</span>
        <span class="s">&#39;%kernel.project_dir%/assets/css&#39;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">css</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="renderizando-conteudo-markdown">
<span id="mailer-markdown"></span><h3>Renderizando Conteúdo Markdown<a class="headerlink" href="#renderizando-conteudo-markdown" title="Link permanente para este título">¶</a></h3>
<p>O Twig fornece outra extensão chamada <code class="docutils literal notranslate">MarkdownExtension</code> que permite
definir o conteúdo do email usando a <a href="#id2"><span class="problematic" id="id3">`sintaxa Markdown`_</span></a>. Para usá-la, instale
a extensão e uma biblioteca de conversão Markdown (a extensão é compatível com
várias bibliotecas populares):</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># instead of league/commonmark, you can also use erusev/parsedown or michelf/php-markdown</span>
<span class="gp">$</span> composer require twig/markdown-extension league/commonmark
</pre></div>
</td></tr></table></div></div>
<p>A extensão adiciona um filtro <code class="docutils literal notranslate">markdown</code>, que você pode usar para converter partes ou
todo o conteúdo do e-mail de Markdown para HTML:</p>
<div class="literal-block"><div class="highlight-twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">apply</span> <span class="nv">markdown</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    Welcome </span><span class="cp">{{</span> <span class="nv">email.toName</span> <span class="cp">}}</span><span class="x">!</span>
<span class="x">    ===========================</span>

<span class="x">    You signed up to our site using the following email:</span>
<span class="x">    `</span><span class="cp">{{</span> <span class="nv">email.to</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="nv">.address</span> <span class="cp">}}</span><span class="x">`</span>

<span class="x">    [Click here to activate your account](</span><span class="cp">{{</span> <span class="nv">url</span><span class="o">(</span><span class="s1">&#39;...&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">)</span>
<span class="cp">{%</span> <span class="k">endapply</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="linguagem-de-template-de-e-mail-inky">
<span id="mailer-inky"></span><h3>Linguagem de Template de E-mail Inky<a class="headerlink" href="#linguagem-de-template-de-e-mail-inky" title="Link permanente para este título">¶</a></h3>
<p>Criar e-mails bem projetados que funcionam em todos os clientes de e-mail é tão
complexo que existem frameworks HTML/CSS dedicados a isso. Um dos frameworks
mais populares é chamado 'Inky`_. Ele define uma sintaxe baseada em algumas
tags que depois são transformadas no código HTML real enviado aos usuários:</p>
<div class="literal-block"><div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- a simplified example of the Inky syntax --&gt;</span>
<span class="p">&lt;</span><span class="nt">container</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">row</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">columns</span><span class="p">&gt;</span>This is a column.<span class="p">&lt;/</span><span class="nt">columns</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">row</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">container</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>O Twig fornece integração com o Inky através da <code class="docutils literal notranslate">InkyExtension</code>. Primeiro, instale
a extensão em sua aplicação:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require twig/inky-extension
</pre></div>
</td></tr></table></div></div>
<p>A extensão adiciona um filtro <code class="docutils literal notranslate">inky</code>, que pode ser usado para converter partes ou
todo o conteúdo do e-mail de Inky para HTML:</p>
<div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">apply</span> <span class="nv">inky</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">container</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">row</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">columns</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">spacer</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;16&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">spacer</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>Welcome <span class="cp">{{</span> <span class="nv">email.toName</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">columns</span><span class="p">&gt;</span>

            <span class="c">{# ... #}</span>
        <span class="p">&lt;/</span><span class="nt">row</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">container</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endapply</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
<p>Você pode combinar todos os filtros para criar mensagens de e-mail complexas:</p>
<div class="literal-block"><div class="highlight-twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">apply</span> <span class="nv">inky</span><span class="o">|</span><span class="nf">inline_css</span><span class="o">(</span><span class="nv">source</span><span class="o">(</span><span class="s1">&#39;@css/foundation-emails.css&#39;</span><span class="o">))</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="c">{# ... #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endapply</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>Isso faz uso do <a class="reference internal" href="#mailer-css-namespace"><span>namespace css Twig</span></a> que criamos
anteriormente. Você poderia, por exemplo, <a class="reference external" href="https://github.com/zurb/foundation-emails/blob/develop/dist/foundation-emails.css">baixar o arquivo foundation-emails.css</a>
diretamente do GitHub e salvá-o em <code class="docutils literal notranslate">assets/css</code>.</p>
</div>
</div>
<div class="section" id="enviando-mensagens-assincronas">
<h2>Enviando Mensagens Assíncronas<a class="headerlink" href="#enviando-mensagens-assincronas" title="Link permanente para este título">¶</a></h2>
<p>Quando você chama <code class="docutils literal notranslate">$mailer-&gt;send($email)</code>, o e-mail é enviado para o transporte imediatamente.
Para melhorar o desempenho, você pode aproveitar o <code class="xref doc docutils literal notranslate">Messenger</code> para enviar
as mensagens depois, através de um transporte do Messenger.</p>
<p>Comece seguindo a documentação do <code class="xref doc docutils literal notranslate">Messenger</code> e configurando
um transporte. Quando tudo estiver configurado, ao você chamar <code class="docutils literal notranslate">$mailer-&gt;send()</code>, uma
mensagem <code class="docutils literal notranslate"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Mailer/Messenger/SendEmailMessage.html" title="Symfony\Component\Mailer\Messenger\SendEmailMessage">SendEmailMessage</a></code>
será despachada através do bus de mensagens padrão (<code class="docutils literal notranslate">messenger.default_bus</code>). Assumindo
que você tem um transporte chamado <code class="docutils literal notranslate">async</code>, você pode rotear a mensagem lá:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/messenger.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">framework</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">messenger</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">transports</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">async</span><span class="p p-Indicator">:</span> <span class="s">&quot;%env(MESSENGER_TRANSPORT_DSN)%&quot;</span>

        <span class="l l-Scalar l-Scalar-Plain">routing</span><span class="p p-Indicator">:</span>
            <span class="s">&#39;Symfony\Component\Mailer\Messenger\SendEmailMessage&#39;</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">async</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/messenger.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:framework=</span><span class="s">&quot;http://symfony.com/schema/dic/symfony&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/symfony</span>
<span class="s">        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;framework:config&gt;</span>
        <span class="nt">&lt;framework:messenger&gt;</span>
            <span class="nt">&lt;framework:routing</span> <span class="na">message-class=</span><span class="s">&quot;Symfony\Component\Mailer\Messenger\SendEmailMessage&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;framework:sender</span> <span class="na">service=</span><span class="s">&quot;async&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/framework:routing&gt;</span>
        <span class="nt">&lt;/framework:messenger&gt;</span>
    <span class="nt">&lt;/framework:config&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/messenger.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;framework&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;messenger&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;routing&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;Symfony\Component\Mailer\Messenger\SendEmailMessage&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;async&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Graças a isso, ao invés de serem entregues imediatamente, as mensagens serão enviadas para
o transporte para serem tratadas mais tarde (veja <span class="xref std std-ref">messenger-worker</span>).</p>
</div>
<div class="section" id="desenvolvimento-e-depuracao">
<h2>Desenvolvimento e Depuração<a class="headerlink" href="#desenvolvimento-e-depuracao" title="Link permanente para este título">¶</a></h2>
<div class="section" id="desabilitando-a-entrega">
<h3>Desabilitando a Entrega<a class="headerlink" href="#desabilitando-a-entrega" title="Link permanente para este título">¶</a></h3>
<p>Durante o desenvolvimento (ou teste), você pode desabilitar a entrega de mensagens completamente.
Você pode fazer isso forçando o Mailer a usar o <code class="docutils literal notranslate">NullTransport</code> somente no ambiente
<code class="docutils literal notranslate">dev</code>:</p>
<div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/dev/mailer.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">framework</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">mailer</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dsn</span><span class="p p-Indicator">:</span> <span class="s">&#39;smtp://null&#39;</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="admonition note"><p class="first admonition-title">Nota</p>
<p class="last">Se você estiver usando o Messenger e roteando para um transporte, a mensagem <em>ainda</em> será
enviada para esse transporte.</p>
</div></div>
</div>
<div class="section" id="enviar-sempre-para-o-mesmo-endereco">
<h3>Enviar Sempre para o Mesmo Endereço<a class="headerlink" href="#enviar-sempre-para-o-mesmo-endereco" title="Link permanente para este título">¶</a></h3>
<p>Em vez de desabilitar totalmente a entrega, você pode querer <em>sempre</em> enviar e-mails para
um endereço específico, em vez do endereço <em>real</em>. Para fazer isso, você pode
aproveitar o <code class="docutils literal notranslate">EnvelopeListener</code> e registrá-lo <em>somente</em> para o ambiente
<code class="docutils literal notranslate">dev</code>:</p>
<div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/services_dev.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">mailer.dev.set_recipients</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Mailer\EventListener\EnvelopeListener</span>
        <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;kernel.event_subscriber&#39;</span><span class="p p-Indicator">]</span>
        <span class="l l-Scalar l-Scalar-Plain">arguments</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">$sender</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
            <span class="l l-Scalar l-Scalar-Plain">$recipients</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;youremail@example.com&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="components/index.html" class="btn btn-neutral float-right" title="Os Componentes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="setup/symfony_server.html" class="btn btn-neutral" title="Servidor Web Local do Symfony" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'pt_BR',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>